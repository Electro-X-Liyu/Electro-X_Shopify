{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'section-related-products.css' | asset_url | stylesheet_tag }}

{% if section.settings.image_shape == 'blob' %}
  {{ 'mask-blobs.css' | asset_url | stylesheet_tag }}
{%- endif -%}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  /* 标题样式 */
  .section-{{ section.id }}-padding .related-products__heading {
    text-align: {{ section.settings.heading_alignment }};
    color: {{ section.settings.heading_color }};
    font-size: {{ section.settings.heading_font_size }}px;
    font-weight: {{ section.settings.heading_font_weight }};
    margin-bottom: {{ section.settings.heading_spacing }}px;
  }

  /* 产品标签样式 */
  .card__badge {
    background: {{ section.settings.badge_background }};
    color: {{ section.settings.badge_text_color }};
    font-size: {{ section.settings.badge_font_size }}px;
    padding: {{ section.settings.badge_padding }}px;
    border-radius: {{ section.settings.badge_border_radius }}px;
  }

  /* 图片悬停效果 */
  .card-wrapper .card__media {
    position: relative;
  }

  .card-wrapper .media--first {
    opacity: 1;
    transition: opacity 0.3s ease;
  }

  .card-wrapper .media--second {
    opacity: 0;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    transition: opacity 0.3s ease;
  }

  .card-wrapper:hover .media--first {
    opacity: 0;
  }

  .card-wrapper:hover .media--second {
    opacity: 1;
  }

  /* 响应式调整 */
  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

<div class="color-{{ section.settings.color_scheme }} gradient">
  <product-recommendations
    class="related-products page-width section-{{ section.id }}-padding isolate{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
    data-url="{{ routes.product_recommendations_url }}?section_id={{ section.id }}&product_id={{ product.id }}&limit={{ section.settings.products_to_show }}"
    data-section-id="{{ section.id }}"
  >
    {% if recommendations.performed and recommendations.products_count > 0 %}
      <h2 class="related-products__heading inline-richtext {{ section.settings.heading_size }}">
        {{ section.settings.heading }}
      </h2>
      <ul
        class="grid product-grid grid--{{ section.settings.columns_desktop }}-col-desktop grid--{{ section.settings.columns_mobile }}-col-tablet-down"
        role="list"
      >
        {% assign skip_card_product_styles = false %}
        {% for recommendation in recommendations.products %}
          <li class="grid__item">
            {% render 'card-product',
              card_product: recommendation,
              media_aspect_ratio: section.settings.image_ratio,
              image_shape: section.settings.image_shape,
              show_secondary_image: true,
              show_vendor: section.settings.show_vendor,
              show_rating: section.settings.show_rating,
              show_badge: true,
              show_quick_add: section.settings.show_quick_add,
              skip_styles: skip_card_product_styles
            %}
          </li>
          {%- assign skip_card_product_styles = true -%}
        {% endfor %}
      </ul>
    {% endif %}
  </product-recommendations>
  {% if section.settings.image_shape == 'arch' %}
    {{ 'mask-arch.svg' | asset_url | split: '?' | first | replace: '.svg', '.css' | stylesheet_tag }}
  {%- endif -%}
</div>

{% schema %}
{
  "name": "t:sections.related-products.name",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "paragraph",
      "content": "t:sections.related-products.settings.paragraph__1.content"
    },
    {
      "type": "header",
      "content": "标题设置"
    },
    {
      "type": "inline_richtext",
      "id": "heading",
      "default": "您可能也会喜欢",
      "label": "标题文本"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "小"
        },
        {
          "value": "h1",
          "label": "中"
        },
        {
          "value": "h0",
          "label": "大"
        }
      ],
      "default": "h1",
      "label": "标题大小"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "标题颜色",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "heading_font_size",
      "min": 12,
      "max": 50,
      "step": 1,
      "unit": "px",
      "label": "标题字体大小",
      "default": 24
    },
    {
      "type": "select",
      "id": "heading_font_weight",
      "label": "标题字体粗细",
      "options": [
        {
          "value": "normal",
          "label": "正常"
        },
        {
          "value": "bold",
          "label": "加粗"
        }
      ],
      "default": "bold"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "标题对齐方式",
      "options": [
        {
          "value": "left",
          "label": "左对齐"
        },
        {
          "value": "center",
          "label": "居中"
        },
        {
          "value": "right",
          "label": "右对齐"
        }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "heading_spacing",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "label": "标题下方间距",
      "default": 30
    },
    {
      "type": "header",
      "content": "产品标签设置"
    },
    {
      "type": "color",
      "id": "badge_background",
      "label": "标签背景色",
      "default": "#FF0000"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "标签文字颜色",
      "default": "#FFFFFF"
    },
    {
      "type": "range",
      "id": "badge_font_size",
      "min": 10,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "标签字体大小",
      "default": 12
    },
    {
      "type": "range",
      "id": "badge_padding",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "px",
      "label": "标签内边距",
      "default": 4
    },
    {
      "type": "range",
      "id": "badge_border_radius",
      "min": 0,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "标签圆角",
      "default": 3
    },
    {
      "type": "header",
      "content": "布局设置"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 10,
      "step": 1,
      "default": 4,
      "label": "显示产品数量"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "default": 4,
      "label": "桌面端列数"
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "default": "2",
      "label": "移动端列数",
      "options": [
        {
          "value": "1",
          "label": "1列"
        },
        {
          "value": "2",
          "label": "2列"
        }
      ]
    },
    {
      "type": "header",
      "content": "产品卡片设置"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": true,
      "label": "显示第二张图片(悬停效果)"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": false,
      "label": "显示供应商"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "default": false,
      "label": "显示评分"
    },
    {
      "type": "checkbox",
      "id": "show_quick_add",
      "default": false,
      "label": "显示快速加入购物车按钮"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        {
          "value": "adapt",
          "label": "适应"
        },
        {
          "value": "portrait",
          "label": "纵向"
        },
        {
          "value": "square",
          "label": "方形"
        }
      ],
      "default": "adapt",
      "label": "图片比例"
    },
    {
      "type": "select",
      "id": "image_shape",
      "options": [
        {
          "value": "default",
          "label": "默认"
        },
        {
          "value": "arch",
          "label": "拱形"
        },
        {
          "value": "blob",
          "label": "斑点"
        },
        {
          "value": "round",
          "label": "圆形"
        }
      ],
      "default": "default",
      "label": "图片形状"
    },
    {
      "type": "header",
      "content": "区块间距"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "上内边距",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "下内边距",
      "default": 36
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "配色方案",
      "default": "scheme-1"
    }
  ]
}
{% endschema %}
